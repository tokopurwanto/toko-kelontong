<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Kelontong Pro - Multi Satuan & Grosir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            body * { visibility: hidden; }
            #receipt-print, #receipt-print * { visibility: visible; }
            #receipt-print { position: absolute; left: 0; top: 0; width: 58mm; padding: 5px; }
        }
        .active-tab { border-bottom: 3px solid white; opacity: 1; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* Toggle Switch Styling */
        .dot { transition: all 0.3s ease-in-out; }
        input:checked ~ .dot { transform: translateX(100%); background-color: #4f46e5; }
        input:checked ~ .block { background-color: #e0e7ff; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-900">

    <!-- Header -->
    <header class="bg-indigo-700 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-black tracking-tighter flex items-center gap-2">
                <span class="bg-white text-indigo-700 p-1 rounded uppercase">POS</span> BERKAH PRO
            </h1>
            <nav class="flex gap-6 font-bold text-sm uppercase">
                <button onclick="changeTab('kasir')" id="nav-kasir" class="active-tab pb-1">Kasir</button>
                <button onclick="changeTab('stok')" id="nav-stok" class="opacity-70 hover:opacity-100">Inventori</button>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4">
        <div id="conn-status" class="hidden mb-4 p-2 text-center text-xs font-bold rounded-lg transition-all duration-500"></div>

        <!-- SECTION KASIR -->
        <section id="section-kasir" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2">
                <div class="bg-white p-3 rounded-xl shadow-sm border border-slate-200 mb-4 flex gap-2">
                    <input type="text" id="search-box" onkeyup="filterItems()" placeholder="Cari nama barang..." class="flex-1 p-4 bg-slate-50 border-none rounded-lg outline-none focus:ring-2 focus:ring-indigo-400 text-lg font-medium">
                </div>
                <div id="grid-barang" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                    <!-- Produk Loader -->
                </div>
            </div>

            <!-- Keranjang -->
            <div class="bg-white p-6 rounded-2xl shadow-xl border border-slate-200 h-fit sticky top-24">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-extrabold text-slate-800">Keranjang</h2>
                    <!-- Toggle Harga Grosir -->
                    <label class="flex items-center cursor-pointer select-none">
                        <span class="mr-3 text-xs font-black text-slate-500 uppercase">Grosir?</span>
                        <div class="relative">
                            <input type="checkbox" id="toggle-grosir" class="sr-only" onchange="renderCart()">
                            <div class="block bg-slate-200 w-10 h-6 rounded-full transition"></div>
                            <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition shadow-sm border border-slate-300"></div>
                        </div>
                    </label>
                </div>
                
                <div id="cart-list" class="space-y-3 max-h-[380px] overflow-y-auto mb-6 pr-2 no-scrollbar border-t pt-4">
                    <!-- List keranjang -->
                </div>

                <div class="border-t pt-6 space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400 font-bold uppercase text-[10px] tracking-widest">Total Bayar</span>
                        <span id="display-total" class="text-3xl font-black text-indigo-700">Rp 0</span>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-xl space-y-3">
                        <input type="number" id="input-bayar" onkeyup="updateKembalian()" class="w-full text-2xl font-bold bg-transparent border-b-2 border-slate-300 focus:border-indigo-500 outline-none p-1" placeholder="Uang Tunai...">
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Kembalian</span>
                            <span id="display-kembalian" class="font-bold text-slate-800 text-xl">Rp 0</span>
                        </div>
                    </div>
                    <button onclick="prosesTransaksi()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-4 rounded-2xl shadow-lg transition-all active:scale-95">
                        PROSES & CETAK NOTA
                    </button>
                </div>
            </div>
        </section>

        <!-- SECTION STOK -->
        <section id="section-stok" class="hidden">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200">
                <div class="p-6 border-b flex justify-between items-center bg-slate-50/50">
                    <h2 class="text-xl font-black text-slate-800 uppercase">Stok & Pengaturan Harga</h2>
                    <button onclick="toggleModal(true)" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-indigo-700 shadow-lg">+ Tambah Barang</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-slate-400 text-[10px] font-black uppercase tracking-widest">
                            <tr>
                                <th class="p-5">Barang</th>
                                <th class="p-5">Stok</th>
                                <th class="p-5">Tingkatan Harga (Ecer | Grosir)</th>
                                <th class="p-5 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="table-stok-body" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- MODAL FORM PRO -->
    <div id="modal-barang" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden flex items-center justify-center p-4 z-[100]">
        <div class="bg-white w-full max-w-2xl rounded-3xl shadow-2xl overflow-hidden max-h-[95vh] overflow-y-auto">
            <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-black text-slate-800">Master Data & Multi Harga</h3>
                <button onclick="toggleModal(false)" class="text-slate-400 hover:text-slate-600">âœ•</button>
            </div>
            <form id="form-barang" class="p-8 space-y-6">
                <input type="hidden" id="f-id">
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase">Nama Barang</label>
                        <input type="text" id="f-nama" required class="w-full p-3 bg-slate-50 border rounded-xl outline-none focus:ring-2 focus:ring-indigo-400">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase">Kategori</label>
                        <input type="text" id="f-kategori" class="w-full p-3 bg-slate-50 border rounded-xl outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase">Stok Dasar (Satuan Terkecil)</label>
                        <input type="number" id="f-stok" required class="w-full p-3 bg-slate-50 border rounded-xl outline-none font-bold text-indigo-600">
                    </div>
                </div>

                <!-- HARGA TIER 1 -->
                <div class="p-5 rounded-2xl border bg-slate-50 border-slate-200">
                    <p class="text-[10px] font-black text-indigo-600 uppercase mb-3">Tingkat 1 (Dasar/Pcs)</p>
                    <div class="grid grid-cols-3 gap-4">
                        <input type="text" id="f-satuan" placeholder="Nama Satuan" class="p-3 border rounded-xl outline-none">
                        <input type="number" id="f-harga-ecer" placeholder="Harga Ecer" class="p-3 border rounded-xl outline-none">
                        <input type="number" id="f-harga-grosir-ecer" placeholder="Harga Grosir" class="p-3 border rounded-xl outline-none bg-amber-50">
                    </div>
                </div>

                <!-- HARGA TIER 2 -->
                <div class="p-5 rounded-2xl border bg-blue-50/50 border-blue-100">
                    <p class="text-[10px] font-black text-blue-600 uppercase mb-3">Tingkat 2 (Opsional)</p>
                    <div class="grid grid-cols-3 gap-4">
                        <input type="number" id="f-isi-box" placeholder="Isi per Unit" class="p-3 border rounded-xl outline-none">
                        <input type="number" id="f-harga-box" placeholder="Harga Ecer" class="p-3 border rounded-xl outline-none">
                        <input type="number" id="f-harga-grosir-box" placeholder="Harga Grosir" class="p-3 border rounded-xl outline-none bg-amber-50">
                    </div>
                </div>

                <!-- HARGA TIER 3 -->
                <div class="p-5 rounded-2xl border bg-amber-50/50 border-amber-100">
                    <p class="text-[10px] font-black text-amber-600 uppercase mb-3">Tingkat 3 (Opsional)</p>
                    <div class="grid grid-cols-3 gap-4">
                        <input type="number" id="f-isi-karton" placeholder="Isi per Unit" class="p-3 border rounded-xl outline-none">
                        <input type="number" id="f-harga-karton" placeholder="Harga Ecer" class="p-3 border rounded-xl outline-none">
                        <input type="number" id="f-harga-grosir-karton" placeholder="Harga Grosir" class="p-3 border rounded-xl outline-none bg-amber-50">
                    </div>
                </div>

                <div class="flex gap-4 pt-4">
                    <button type="button" onclick="toggleModal(false)" class="flex-1 py-4 text-slate-400 font-bold uppercase">Batal</button>
                    <button type="submit" class="flex-1 py-4 bg-indigo-600 text-white rounded-2xl font-black shadow-lg uppercase tracking-widest">Simpan Data</button>
                </div>
            </form>
        </div>
    </div>

    <!-- AREA STRUK -->
    <div id="receipt-print" class="hidden font-mono text-[10px]">
        <div class="text-center mb-4">
            <p class="font-bold text-xs uppercase">Toko Berkah Kelontong</p>
            <p>============================</p>
        </div>
        <div id="receipt-items" class="space-y-1"></div>
        <p>============================</p>
        <div class="flex justify-between font-bold"><span>TOTAL</span><span id="r-total"></span></div>
        <div class="flex justify-between"><span>BAYAR</span><span id="r-bayar"></span></div>
        <div class="flex justify-between"><span>KEMBALI</span><span id="r-kembali"></span></div>
        <p>============================</p>
        <p id="r-tgl" class="text-center mt-2"></p>
        <p class="text-center mt-1">Terima Kasih</p>
    </div>

    <script>
        const SB_URL = "https://aafacwvmzxzpyyxryuoc.supabase.co/rest/v1";
        const SB_KEY = "sb_publishable_ARHLAIm1BNBWUTGBqfX8zA_OYlZHB9-"; 
        
        const headers = {
            "apikey": SB_KEY,
            "Authorization": `Bearer ${SB_KEY}`,
            "Content-Type": "application/json",
            "Prefer": "return=representation"
        };

        let listBarang = [];
        let keranjang = [];
        let total = 0;

        async function init() {
            try {
                updateStatus("Sinkronisasi...", "bg-amber-400 text-white");
                const res = await fetch(`${SB_URL}/barang?select=*&order=nama.asc`, { headers });
                listBarang = await res.json();
                renderBarang();
                renderTabel();
                updateStatus("Online", "bg-emerald-500 text-white", 3000);
            } catch (err) {
                updateStatus("Offline / Database Error", "bg-rose-500 text-white");
            }
        }

        function renderBarang(q = "") {
            const grid = document.getElementById('grid-barang');
            grid.innerHTML = "";
            const filtered = listBarang.filter(b => b.nama.toLowerCase().includes(q.toLowerCase()));

            filtered.forEach(b => {
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-3xl shadow-sm border border-slate-100 hover:border-indigo-500 transition-all flex flex-col justify-between";
                
                let buttons = `<button onclick="addToCart(${b.id}, 1)" class="flex-1 bg-indigo-50 text-indigo-600 py-2 rounded-xl text-[10px] font-black hover:bg-indigo-600 hover:text-white uppercase transition">${b.satuan || 'Pcs'}</button>`;
                
                if(b.isi_box > 0) {
                    buttons += `<button onclick="addToCart(${b.id}, 2)" class="flex-1 bg-blue-50 text-blue-600 py-2 rounded-xl text-[10px] font-black hover:bg-blue-600 hover:text-white uppercase transition">Tkt 2</button>`;
                }
                
                if(b.isi_karton > 0) {
                    buttons += `<button onclick="addToCart(${b.id}, 3)" class="flex-1 bg-amber-50 text-amber-600 py-2 rounded-xl text-[10px] font-black hover:bg-amber-600 hover:text-white uppercase transition">Tkt 3</button>`;
                }

                card.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[9px] font-black text-slate-400 uppercase bg-slate-50 px-2 py-1 rounded-md tracking-tighter">${b.kategori || 'Umum'}</span>
                            <span class="text-[10px] font-bold ${b.stok < 10 ? 'text-rose-500' : 'text-slate-400'}">Stok: ${b.stok}</span>
                        </div>
                        <h3 class="font-bold text-slate-800 text-base mb-1 leading-tight">${b.nama}</h3>
                        <p class="text-lg font-black text-indigo-700 mb-4">Rp ${Number(b.harga_ecer).toLocaleString()}</p>
                    </div>
                    <div class="flex gap-2">
                        ${buttons}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function addToCart(id, level) {
            const b = listBarang.find(item => item.id === id);
            const isGrosir = document.getElementById('toggle-grosir').checked;
            
            let label, price, baseQty;

            // Logika Penentuan Harga Berdasarkan Level & Mode (Grosir/Ecer)
            if(level === 1) {
                label = b.satuan || 'Pcs';
                price = isGrosir && b.harga_grosir_ecer > 0 ? b.harga_grosir_ecer : b.harga_ecer;
                baseQty = 1;
            } else if(level === 2) {
                label = "Unit Tkt 2";
                price = isGrosir && b.harga_grosir_box > 0 ? b.harga_grosir_box : b.harga_box;
                baseQty = b.isi_box;
            } else {
                label = "Unit Tkt 3";
                price = isGrosir && b.harga_grosir_karton > 0 ? b.harga_grosir_karton : b.harga_karton;
                baseQty = b.isi_karton;
            }

            if(b.stok < baseQty) return alert("Maaf, stok tidak cukup.");

            const key = `${id}-${level}`; // Key unik supaya eceran & grosir di barang yang sama tidak tercampur harganya di list
            const existing = keranjang.find(k => k.cartKey === key && k.isGrosir === isGrosir);
            
            if(existing) {
                if((existing.qty + 1) * baseQty <= b.stok) {
                    existing.qty++;
                } else {
                    alert("Limit stok tercapai!");
                }
            } else {
                keranjang.push({ ...b, cartKey: key, qty: 1, label, price, baseQty, isGrosir });
            }
            renderCart();
        }

        function renderCart() {
            // Re-kalkulasi harga jika toggle grosir berubah (untuk barang yang sudah ada di keranjang)
            const isGrosirGlobal = document.getElementById('toggle-grosir').checked;
            
            // Opsional: Jika ingin harga di keranjang otomatis berubah saat saklar digeser:
            keranjang = keranjang.map(item => {
                const b = listBarang.find(x => x.id === item.id);
                const level = parseInt(item.cartKey.split('-')[1]);
                let newPrice;
                if(level === 1) newPrice = isGrosirGlobal && b.harga_grosir_ecer > 0 ? b.harga_grosir_ecer : b.harga_ecer;
                else if(level === 2) newPrice = isGrosirGlobal && b.harga_grosir_box > 0 ? b.harga_grosir_box : b.harga_box;
                else newPrice = isGrosirGlobal && b.harga_grosir_karton > 0 ? b.harga_grosir_karton : b.harga_karton;
                
                return { ...item, price: newPrice, isGrosir: isGrosirGlobal };
            });

            const list = document.getElementById('cart-list');
            list.innerHTML = "";
            total = 0;

            keranjang.forEach((item, index) => {
                const sub = item.price * item.qty;
                total += sub;
                list.innerHTML += `
                    <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 flex justify-between items-center group">
                        <div class="flex-1">
                            <p class="font-bold text-slate-800 text-sm">${item.nama}</p>
                            <p class="text-[10px] font-black ${item.isGrosir ? 'text-amber-500' : 'text-indigo-500'} uppercase">
                                ${item.qty} ${item.label} @ Rp ${Number(item.price).toLocaleString()} 
                                ${item.isGrosir ? '(GROSIR)' : ''}
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="font-black text-slate-900">Rp ${sub.toLocaleString()}</p>
                            <button onclick="removeItem(${index})" class="text-[10px] text-rose-500 font-bold uppercase opacity-0 group-hover:opacity-100 transition">Hapus</button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('display-total').innerText = `Rp ${total.toLocaleString()}`;
            updateKembalian();
        }

        function removeItem(index) { keranjang.splice(index, 1); renderCart(); }

        async function prosesTransaksi() {
            const bayar = document.getElementById('input-bayar').value;
            if (keranjang.length === 0 || bayar < total) return alert("Periksa total belanja dan uang bayar.");

            try {
                const resH = await fetch(`${SB_URL}/transaksi`, {
                    method: 'POST', headers,
                    body: JSON.stringify({ total: total })
                });
                const head = await resH.json();
                const tid = head[0].id;

                for (const i of keranjang) {
                    const totalPcsUsed = i.qty * i.baseQty;
                    
                    await fetch(`${SB_URL}/transaksi_detail`, {
                        method: 'POST', headers,
                        body: JSON.stringify({ 
                            transaksi_id: tid, 
                            barang_id: i.id, 
                            qty: i.qty, 
                            harga: i.price,
                            catatan: `Unit: ${i.label} | ${i.isGrosir ? 'GROSIR' : 'ECER'}`
                        })
                    });

                    await fetch(`${SB_URL}/barang?id=eq.${i.id}`, {
                        method: 'PATCH', headers,
                        body: JSON.stringify({ stok: i.stok - totalPcsUsed })
                    });
                }

                printNota(bayar);
                clearCart();
                init();
                alert("Transaksi Berhasil!");
            } catch (err) { alert("Sistem error saat memproses transaksi."); }
        }

        function printNota(bayar) {
            const area = document.getElementById('receipt-items');
            area.innerHTML = "";
            keranjang.forEach(i => {
                area.innerHTML += `
                    <div class="flex justify-between"><span>${i.nama}</span></div>
                    <div class="flex justify-between text-[8px] italic">
                        <span>${i.qty} ${i.label} ${i.isGrosir ? '(G)' : ''} x ${Number(i.price).toLocaleString()}</span>
                        <span>${(i.qty * i.price).toLocaleString()}</span>
                    </div>
                `;
            });
            document.getElementById('r-total').innerText = total.toLocaleString();
            document.getElementById('r-bayar').innerText = Number(bayar).toLocaleString();
            document.getElementById('r-kembali').innerText = (bayar - total).toLocaleString();
            document.getElementById('r-tgl').innerText = new Date().toLocaleString();
            window.print();
        }

        // --- STOK & MODAL ---
        function renderTabel() {
            const tbody = document.getElementById('table-stok-body');
            tbody.innerHTML = "";
            listBarang.forEach(b => {
                tbody.innerHTML += `
                    <tr class="hover:bg-slate-50 transition border-b border-slate-50">
                        <td class="p-5">
                            <p class="font-bold text-slate-800">${b.nama}</p>
                            <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">${b.kategori || 'Tanpa Kategori'}</p>
                        </td>
                        <td class="p-5">
                            <span class="font-black ${b.stok < 10 ? 'text-rose-500' : 'text-indigo-600'}">${b.stok}</span>
                            <span class="text-[10px] text-slate-400 font-normal ml-1 uppercase">${b.satuan}</span>
                        </td>
                        <td class="p-5">
                            <div class="text-[9px] space-y-1">
                                <div class="flex gap-4">
                                    <span class="w-12 text-slate-400 uppercase font-black">${b.satuan}:</span>
                                    <span class="font-bold">Rp ${Number(b.harga_ecer).toLocaleString()} <span class="text-amber-500">| Rp ${Number(b.harga_grosir_ecer).toLocaleString()}</span></span>
                                </div>
                                ${b.isi_box > 0 ? `
                                <div class="flex gap-4">
                                    <span class="w-12 text-slate-400 uppercase font-black">Tkt 2:</span>
                                    <span class="font-bold">Rp ${Number(b.harga_box).toLocaleString()} <span class="text-amber-500">| Rp ${Number(b.harga_grosir_box).toLocaleString()}</span></span>
                                </div>` : ''}
                                ${b.isi_karton > 0 ? `
                                <div class="flex gap-4">
                                    <span class="w-12 text-slate-400 uppercase font-black">Tkt 3:</span>
                                    <span class="font-bold">Rp ${Number(b.harga_karton).toLocaleString()} <span class="text-amber-500">| Rp ${Number(b.harga_grosir_karton).toLocaleString()}</span></span>
                                </div>` : ''}
                            </div>
                        </td>
                        <td class="p-5 text-center">
                            <button onclick='editForm(${JSON.stringify(b)})' class="bg-indigo-50 px-4 py-2 rounded-lg text-indigo-600 font-bold text-xs hover:bg-indigo-600 hover:text-white transition">EDIT</button>
                        </td>
                    </tr>
                `;
            });
        }

        document.getElementById('form-barang').onsubmit = async (e) => {
            e.preventDefault();
            const id = document.getElementById('f-id').value;
            const payload = {
                nama: document.getElementById('f-nama').value,
                kategori: document.getElementById('f-kategori').value,
                stok: parseInt(document.getElementById('f-stok').value),
                satuan: document.getElementById('f-satuan').value,
                
                harga_ecer: parseFloat(document.getElementById('f-harga-ecer').value || 0),
                harga_grosir_ecer: parseFloat(document.getElementById('f-harga-grosir-ecer').value || 0),
                
                isi_box: parseInt(document.getElementById('f-isi-box').value || 0),
                harga_box: parseFloat(document.getElementById('f-harga-box').value || 0),
                harga_grosir_box: parseFloat(document.getElementById('f-harga-grosir-box').value || 0),
                
                isi_karton: parseInt(document.getElementById('f-isi-karton').value || 0),
                harga_karton: parseFloat(document.getElementById('f-harga-karton').value || 0),
                harga_grosir_karton: parseFloat(document.getElementById('f-harga-grosir-karton').value || 0),
            };

            const method = id ? 'PATCH' : 'POST';
            const url = id ? `${SB_URL}/barang?id=eq.${id}` : `${SB_URL}/barang`;

            const res = await fetch(url, { method, headers, body: JSON.stringify(payload) });
            if (res.ok) { toggleModal(false); init(); }
        };

        function editForm(b) {
            toggleModal(true);
            document.getElementById('f-id').value = b.id;
            document.getElementById('f-nama').value = b.nama;
            document.getElementById('f-kategori').value = b.kategori;
            document.getElementById('f-stok').value = b.stok;
            document.getElementById('f-satuan').value = b.satuan;
            document.getElementById('f-harga-ecer').value = b.harga_ecer;
            document.getElementById('f-harga-grosir-ecer').value = b.harga_grosir_ecer;
            document.getElementById('f-isi-box').value = b.isi_box || 0;
            document.getElementById('f-harga-box').value = b.harga_box || 0;
            document.getElementById('f-harga-grosir-box').value = b.harga_grosir_box || 0;
            document.getElementById('f-isi-karton').value = b.isi_karton || 0;
            document.getElementById('f-harga-karton').value = b.harga_karton || 0;
            document.getElementById('f-harga-grosir-karton').value = b.harga_grosir_karton || 0;
        }

        // --- UTILS ---
        function toggleModal(s) { document.getElementById('modal-barang').classList.toggle('hidden', !s); if(!s) { document.getElementById('form-barang').reset(); document.getElementById('f-id').value = ""; } }
        function changeTab(t) {
            document.getElementById('section-kasir').classList.toggle('hidden', t !== 'kasir');
            document.getElementById('section-stok').classList.toggle('hidden', t !== 'stok');
            document.getElementById('nav-kasir').classList.toggle('active-tab', t === 'kasir');
            document.getElementById('nav-stok').classList.toggle('active-tab', t === 'stok');
        }
        function updateKembalian() {
            const b = document.getElementById('input-bayar').value || 0;
            document.getElementById('display-kembalian').innerText = `Rp ${Math.max(0, b - total).toLocaleString()}`;
        }
        function clearCart() { keranjang = []; renderCart(); }
        function filterItems() { renderBarang(document.getElementById('search-box').value); }
        function updateStatus(m, c, d=0) {
            const b = document.getElementById('conn-status');
            b.innerText = m; b.className = `mb-4 p-2 text-center text-xs font-bold rounded-lg ${c}`;
            b.classList.remove('hidden');
            if(d > 0) setTimeout(() => b.classList.add('hidden'), d);
        }

        window.onload = init;
    </script>
</body>
</html>
