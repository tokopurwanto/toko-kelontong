<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOKO KELONTONG PURWANTO - Sistem Kasir Modern</title>
    <link rel="stylesheet" href="styletoko.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Container Loading -->
    <div id="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Memuat aplikasi...</p>
    </div>

    <!-- Container Utama -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-store"></i> TOKO KELONTONG PURWANTO</h1>
            <div class="subtitle">Sistem Kasir Modern dengan Database Cloud</div>
            <button class="btn-manage" onclick="openProductManager()">
                <i class="fas fa-boxes"></i> Kelola Produk
            </button>
        </div>

        <!-- Konten Utama -->
        <div class="content">
            <!-- Panel Kiri: Daftar Barang -->
            <div class="left-panel">
                <h2 class="section-title"><i class="fas fa-list"></i> Daftar Barang</h2>
                
                <div class="search-box">
                    <span class="search-icon"><i class="fas fa-search"></i></span>
                    <input type="text" id="searchInput" placeholder="Cari barang...">
                    <button class="btn-clear-search" onclick="clearSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Mode Penjualan -->
                <section class="selling-mode">
                    <h3><i class="fas fa-shopping-cart"></i> Mode Penjualan</h3>
                    <div class="mode-buttons">
                        <button id="ecer-btn" class="mode-btn active">
                            <i class="fas fa-user"></i> ECER
                        </button>
                        <button id="grosir-btn" class="mode-btn">
                            <i class="fas fa-users"></i> GROSIR
                        </button>
                    </div>
                    <p class="mode-info">
                        Mode: <span id="current-mode">Ecer</span> |
                        Harga: <span id="price-type">Harga Ecer</span>
                    </p>
                </section>

                <div class="product-grid" id="productGrid">
                    <!-- Produk akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Panel Kanan: Transaksi -->
            <div class="right-panel">
                <!-- Tanggal & Waktu -->
                <div class="datetime-display">
                    <div class="date" id="currentDate">Minggu, 14 December 2025</div>
                    <div class="time" id="currentTime">09:32:14</div>
                </div>

                <!-- Tabel Transaksi -->
                <div class="transaction-table">
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Nama Barang</th>
                                <th>Qty</th>
                                <th>Harga</th>
                                <th>Total</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="transactionTable">
                            <!-- Transaksi akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Panel Pembayaran -->
                <div class="payment-panel">
                    <h2 class="section-title"><i class="fas fa-cash-register"></i> Pembayaran</h2>
                    
                    <div class="payment-row">
                        <span>Subtotal:</span>
                        <span class="price-display" id="subtotal">Rp 0</span>
                    </div>
                    
                    <div class="payment-row">
                        <span>Pajak (10%):</span>
                        <span class="price-display" id="tax">Rp 0</span>
                    </div>
                    
                    <div class="payment-row total">
                        <span>TOTAL:</span>
                        <span id="total">Rp 0</span>
                    </div>

                    <div class="payment-input">
                        <label for="cashInput">
                            <i class="fas fa-money-bill-wave"></i> Uang Diberikan:
                        </label>
                        <input type="number" id="cashInput" placeholder="Masukkan jumlah uang" min="0">
                    </div>

                    <div class="change-display" id="changeDisplay">
                        <i class="fas fa-exchange-alt"></i> Kembalian: Rp 0
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="processPayment()">
                            <i class="fas fa-check-circle"></i> PROSES PEMBAYARAN
                        </button>
                        <button class="btn btn-secondary" onclick="resetTransaction()">
                            <i class="fas fa-redo"></i> RESET TRANSAKSI
                        </button>
                        <button class="btn btn-success" onclick="openReceiptModal()">
                            <i class="fas fa-receipt"></i> CETAK STRUK
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Manager Produk -->
    <div id="productManagerModal" class="modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2><i class="fas fa-boxes"></i> Manajemen Produk</h2>
                <button class="close-modal" onclick="closeProductManager()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="manager-actions">
                    <button class="btn-manager" onclick="showAddProductForm()">
                        <i class="fas fa-plus"></i> Tambah Produk Baru
                    </button>
                    <button class="btn-manager" onclick="exportProducts()">
                        <i class="fas fa-file-export"></i> Export Data
                    </button>
                    <button class="btn-manager" onclick="importProducts()">
                        <i class="fas fa-file-import"></i> Import Data
                    </button>
                </div>

                <div class="manager-search">
                    <input type="text" id="managerSearch" placeholder="Cari produk..." oninput="searchManagerProducts()">
                </div>

                <div class="product-table-container">
                    <table class="manager-table">
                        <thead>
                            <tr>
                                <th>Kode</th>
                                <th>Nama Produk</th>
                                <th>Harga Ecer</th>
                                <th>Harga Grosir</th>
                                <th>Stok</th>
                                <th>Kategori</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="managerTable">
                            <!-- Data produk akan diisi -->
                        </tbody>
                    </table>
                </div>

                <div class="manager-summary">
                    Total Produk: <span id="productCount">0</span> | 
                    Total Stok: <span id="totalStock">0</span>
                </div>

                <!-- Form Tambah/Edit Produk -->
                <div id="productForm" style="display: none;">
                    <h3><i class="fas fa-edit"></i> Form Produk</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productCode">Kode Produk *</label>
                            <input type="text" id="productCode" required>
                        </div>
                        <div class="form-group">
                            <label for="productName">Nama Produk *</label>
                            <input type="text" id="productName" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="retailPrice">Harga Ecer *</label>
                            <input type="number" id="retailPrice" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="wholesalePrice">Harga Grosir *</label>
                            <input type="number" id="wholesalePrice" required min="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="stock">Stok *</label>
                            <input type="number" id="stock" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="category">Kategori</label>
                            <select id="category">
                                <option value="Makanan">Makanan</option>
                                <option value="Minuman">Minuman</option>
                                <option value="Sembako">Sembako</option>
                                <option value="ATK">ATK</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="description">Deskripsi</label>
                            <textarea id="description" rows="3"></textarea>
                        </div>
                    </div>
                    <input type="hidden" id="editProductId">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" onclick="cancelProductForm()">
                    <i class="fas fa-times"></i> Batal
                </button>
                <button class="btn-modal btn-save" onclick="saveProduct()">
                    <i class="fas fa-save"></i> Simpan
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Struk -->
    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-receipt"></i> Struk Pembayaran</h2>
                <button class="close-modal" onclick="closeReceiptModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="receipt-content">
                    <!-- Struk akan diisi oleh JavaScript -->
                </div>
                <button class="btn-print-receipt" onclick="printReceipt()">
                    <i class="fas fa-print"></i> Cetak Struk
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Konfirmasi -->
    <div id="confirmModal" class="modal">
        <div class="modal-content confirm-modal">
            <div class="modal-body">
                <i class="fas fa-question-circle"></i>
                <h3 id="confirmTitle">Konfirmasi</h3>
                <p id="confirmMessage">Apakah Anda yakin?</p>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" onclick="confirmAction(false)">
                    <i class="fas fa-times"></i> Tidak
                </button>
                <button class="btn-modal btn-save" onclick="confirmAction(true)">
                    <i class="fas fa-check"></i> Ya
                </button>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script src="interaksi.js"></script>
    <script src="app.jsw"></script>
</body>
</html>